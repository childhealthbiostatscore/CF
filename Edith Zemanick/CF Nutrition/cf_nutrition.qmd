---
title: "CF Nutrition Pre- and Post-CFTR Modulator"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    self-contained: true
editor: visual
---

```{r include=FALSE}
library(readxl)
library(tidyverse)
library(parsedate)
library(arsenal)
```

```{r}
# Import all data
df = read.csv("/Users/timvigers/Documents/Work/Vigers/CF/Edith Zemanick/CF Nutrition/Data_Cleaned/analysis.csv",na.strings = "",check.names = F)
df$Timepoint = factor(df$Timepoint,levels = c("Pre","Post"))
```

# Data Cleaning

-   All vitamin, PFT, and BMI percentile values were converted to numeric, so values such as "LESS THAN 0.4" were marked as missing.

-   We excluded visits more than 3 years prior to effective modulator start and within 90 after effective modulator start.

-   All values prior to effective modulator start were averaged to calculate the "pre" value. We selected the most recent vitamin values as the "post" value, and included any BMI percentile, FEV1 % predicted, ALT, AST, and GGTP measures within a month of that visit.

-   Sex was only included in the PFT datasheet, so those without PFT data were missing this variable.

# Baseline value grouped by first modulator

```{r results='asis'}
t1 <- tableby(`First Modulator` ~ `Vitamin A` + `Vitamin D` + `Vitamin E Alpha` +
  `ppFEV1` + `BMI Percentile` +
  `ALT` + `High ALT (3x)` + `High ALT (5x)` +
  `AST` + `High AST (3x)` + `High AST (5x)` +
  `GGTP` + `High GGTP (3x)` + `High GGTP (5x)`,
data = df[df$Timepoint == "Pre", ]
)
summary(t1, pfootnote = T)
```

# Pre/post comparison

```{r results='asis'}
p <- paired(Timepoint ~ `Vitamin A` + signed.rank(`Vitamin D`) + `Vitamin E Alpha` +
  `ppFEV1` + `BMI Percentile` +
  signed.rank(`ALT`) + `High ALT (3x)` + notest(`High ALT (5x)`) +
  signed.rank(`AST`) + `High AST (3x)` + notest(`High AST (5x)`) +
  signed.rank(`GGTP`) + notest(`High GGTP (3x)`) + notest(`High GGTP (5x)`),
data = df, id = ID
)
summary(p, pfootnote = T)
```
