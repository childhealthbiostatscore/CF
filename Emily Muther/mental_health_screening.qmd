---
title: "Mental Health Screening in CF"
author: "Tim Vigers"
date: "today"
date-format: long
format:
  html:
    toc: true
    toc-depth: 5
    toc-float: true
    code-fold: true
    self-contained: true
    fig-cap-location: top
    page-layout: full
editor: source
---

# Data cleaning

1. For each participant, the first recorded visit was designated as baseline.

```{r include=FALSE}
library(tidyverse)
library(plotly)
library(gtsummary)
library(GLMMadaptive)
# Import
df = read.csv("/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Vigers/CF/Emily Muther/Mental Health Screening/Data_Cleaned/MH master data.csv",check.names = F,na.strings = "")
# Column types
df$CONTACT_DATE = lubridate::mdy(df$CONTACT_DATE)
df$`PHQ-9 Total Score (calculated)` = as.integer(df$`PHQ-9 Total Score (calculated)`)
# Visits
df = df %>% arrange(MRN,CONTACT_DATE) %>% group_by(MRN) %>%
  mutate(`Visit Number` = row_number(), 
         `Days From Baseline` = as.numeric(CONTACT_DATE - CONTACT_DATE[1]))
```

# Plots

```{r warning=FALSE}
p_phq9_hist = ggplot(df,aes(x = `PHQ-9 Total Score (calculated)`)) + 
  geom_histogram(binwidth = 1) +
  scale_x_continuous(breaks = 0:27) +
  theme_bw() 
ggplotly(p_phq9_hist)

p_phq9_days = ggplot(df,aes(x=`Days From Baseline`,y = `PHQ-9 Total Score (calculated)`,group=MRN)) + 
  geom_line(aes(color=factor(MRN)),alpha=0.2) +
  theme_bw() +
  theme(legend.position = "none")
ggplotly(p_phq9_days)

p_phq9_visit = ggplot(df,aes(x=`Visit Number`,y = `PHQ-9 Total Score (calculated)`,group=MRN)) + 
  geom_line(aes(color=factor(MRN)),alpha=0.2) +
  theme_bw() +
  theme(legend.position = "none")
ggplotly(p_phq9_visit)
```

# Methods

Because the PHQ-9 results are right-skewed with lots of 0 scores, we used a zero inflated Poisson mixed model to analyze change in score over time.

