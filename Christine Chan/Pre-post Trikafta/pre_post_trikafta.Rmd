---
title: "Pre/Post-Trikafta"
author: "Tim Vigers"
date: "`r format(Sys.time(), '%d %B %Y')`"
output:
  html_document:
    number_sections: yes
    toc: yes
    toc_depth: 2
    toc_float: yes
---

```{r setup, include=FALSE}
library(arsenal)
library(tidyverse)
library(lubridate)
library(readxl)
library(PAutilities)
library(AGD)
library(rspiro)
library(anthro)
library(knitr)
knitr::opts_chunk$set(echo = FALSE)
knitr::opts_knit$set(root.dir = "/Volumes/PEDS/RI Biostatistics Core/Shared/Shared Projects/Vigers/CF/Christine Chan/Prepost Triakfta")
```

```{r code from maxie,eval=FALSE}
# Source Maxie's code, and write final ID lists
source("~/GitHub/CF/Christine Chan/Pre-post Trikafta/p001+cmw_UPDATED.R")
ids = data.frame(unique(analytic_cm$CFF.ID))
colnames(ids) = "CFF.ID"
write.csv(ids,file = "./Data_Cleaned/final_ids.csv",row.names = F)
```

# Table 1: Demographics at Trikafta Start

```{r eval=FALSE}
# Start dates
chco_dates = read.csv("./Data_Cleaned/chco_trikafta_dates.csv",na.strings = "")
# Fix select dates
chco_dates$Earliest.Trikafta.Date.in.PortCF[chco_dates$MRN =="1053930"] = "12/1/2019"
chco_dates$Earliest.Trikafta.Date.in.PortCF[chco_dates$MRN =="1695512"] = "12/12/2019"
chco_dates$Earliest.Trikafta.Date.in.PortCF[chco_dates$MRN =="815274"] = "12/13/2019"
chco_dates$Earliest.Trikafta.Date.in.PortCF[chco_dates$MRN =="1078408"] = "3/9/2020"
chco_dates$Earliest.Trikafta.Date.in.PortCF[chco_dates$MRN =="899717"] = "2/14/2020"
chco_dates$CFF.ID = as.character(chco_dates$CFF.ID)
# A1C and OGTT
chco_a1c = read.csv("./Data_Cleaned/chco_a1c_ogtt.csv")
chco_a1c$CFF.ID = as.character(chco_a1c$CFF.ID)
chco_pft = read.csv("./Data_Cleaned/chco_bmi_pft.csv")
# Merge
chco = left_join(chco_dates,chco_a1c,by = "CFF.ID")
chco = full_join(chco,chco_pft,by = c("MRN", "Date"))
# Diabetes only
chco = chco %>% filter(Diabetes == 1) %>% mutate(Location = "CHCO") %>%
  select(CFF.ID,DOB,Earliest.Trikafta.Date.in.PortCF,
         Sex,Race,Hispanic.Latinx,Genotypes1,Genotypes2,Pancreatic.Status,G.tube.in.past.12.months,
         Date,HbA1c,OGTT_Fasting,OGTT_TwoHour,Height:Location) %>%
  rename(Start = Earliest.Trikafta.Date.in.PortCF)
# Montana
montana = read.csv("./Data_Raw/Data From Montana/Copy of Paper patient population glycemic (+hofer).csv",na.strings = "")
demo_adult = read.csv("./Data_Raw/Data From Montana/demo_adults.csv",na.strings = "")
demo_kids = read.csv("./Data_Raw/Data From Montana/demo_kids.csv",na.strings = "")
demo_kids$Date.Of.Birth..mm.dd.yyyy. = NULL
demo_kids = demo_kids[,colnames(demo_adult)]
demo = rbind(demo_adult,demo_kids)
# Get within a year of Trikafta start
montana$time_diff = mdy(montana$Trikafta.start.date) - mdy(montana$Date.of.Encounter)
montana = montana %>% filter(abs(montana$time_diff)<=365)
# Add demographics
montana = left_join(montana,demo,by = "CFF.ID")
# PFTs
pft_adult <- read.csv("./Data_Raw/Data From Montana/Copy of PFTs growth adult (+hofer).csv")
pft_kids <- read.csv("./Data_Raw/Data From Montana/PFTs kids.csv")
```

```{r}

```
